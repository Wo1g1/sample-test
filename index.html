<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>마법 세계관 테스트 — 데모 v4</title>
<style>
  :root{
    --bg:#0b0c10;--panel:#14161c;--ink:#e8ecf1;--muted:#a7b0bd;--accent:#5aa9e6;--accent2:#ef476f;
    --good:#06d6a0;--good2:#41ead4; /* 좌측 */
    --mid:#ffffff; /* 중립 */
    --warn:#ffd166;--warn2:#f77f00; /* 우측 */
    --line:#253045;--chip:#0e1117;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{max-width:900px;margin:0 auto;padding:20px}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,12,16,.95),rgba(11,12,16,.5));backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid var(--line)}
  .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 0}
  h1{font-size:18px;margin:0}
  .chip{background:var(--chip);border:1px solid var(--line);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
  .btn{border:1px solid var(--line);background:#0f1117;color:var(--ink);padding:10px 12px;border-radius:12px;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#7bdff2);color:#081018}
  .note{font-size:12px;color:var(--muted)}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin-top:12px}
  .results{margin-top:18px;display:grid;gap:16px}
  .bar{background:#0f1117;border:1px solid var(--line);border-radius:12px;padding:12px}
  .barrow{position:relative;height:34px;border-radius:10px;overflow:hidden;border:1px solid var(--line)}
  .baroverlay{position:absolute;inset:0;display:flex;color:#fff;font-size:12px;text-shadow:0 1px 2px rgba(0,0,0,.7)}
  .cell{display:flex;align-items:center;justify-content:center}
  .barlbl{display:flex;justify-content:space-between;margin-top:6px;font-size:12px;color:var(--muted)}
  .hidden{display:none}
</style>
</head>
<body>
<header>
  <div class="wrap toolbar">
    <h1>마법 세계관 테스트 — 데모 v4</h1>
    <span class="chip" id="stageChip">시작 전</span>
  </div>
</header>
<main class="wrap" id="app">
  <section id="start" class="card">
    <h2>시작하기</h2>
    <p class="note">50문항, 5페이지. 무작위 섞임. 1=전혀 아님 ~ 5=적극 동의, 3=중립은 축별 중립률만 계산.</p>
    <button class="btn primary" id="startBtn">테스트 시작</button>
  </section>
  <section id="quizWrap" class="hidden">
    <div class="card">
      <div id="quiz"></div>
      <div style="display:flex;justify-content:space-between;margin-top:12px">
        <button class="btn" id="prevBtn">이전</button>
        <span class="chip" id="pageInfo">1 / 5</span>
        <button class="btn primary" id="nextBtn">다음</button>
        <button class="btn primary hidden" id="finishBtn">결과 보기</button>
      </div>
    </div>
  </section>
  <section id="results" class="results hidden"></section>
  <div id="resultsActions" class="hidden" style="margin-top:10px;text-align:right">
    <button class="btn" id="restartBtn">처음으로</button>
  </div>
</main>
<script>
const AXES={M:{left:"친마법",right:"반마법"},E:{left:"평등",right:"권위"},L:{left:"자유",right:"규제"},P:{left:"진보",right:"보수"}};
// 명칭 매핑 (캔버스 정의 반영)
const COMBOS={
  "좌-좌-좌":"혁명주의자","좌-좌-우":"사회주의자","좌-우-좌":"자유보수주의자","좌-우-우":"국가주의자",
  "좌-좌-중도":"진보적 평등주의자","우-좌-중도":"보수적 평등주의자","좌-중도-좌":"진보적 자유주의자","우-중도-좌":"보수적 자유주의자",
  "중도-좌-중도":"중도적 평등주의자","중도-우-중도":"중도적 권위주의자","중도-중도-좌":"중도적 자유주의자","중도-중도-우":"중도적 규제주의자",
  "중도-중도-중도":"극단적 중도주의자"
};
const RESP_FACTOR={1:-1.2,2:-1.0,3:0,4:1.0,5:1.2};
const QUESTIONS=[{id:1,text:"마법은 학문으로 인정받아야 한다.",S:1.0,effects:[{axis:'M',side:'친마법',w:1.0}]}]; // 샘플, 실제는 50개

function shuffle(a){return a.sort(()=>Math.random()-.5)}
let ORDERED=[],ANSWERS={},CUR=0;
const PER_PAGE=10,PAGES=5;
function initQuiz(){ORDERED=shuffle(QUESTIONS).slice(0,50);ANSWERS={};CUR=0;
 document.getElementById('stageChip').textContent='진행 중';
 document.getElementById('start').classList.add('hidden');
 document.getElementById('results').classList.add('hidden');
 document.getElementById('resultsActions').classList.add('hidden');
 document.getElementById('quizWrap').classList.remove('hidden');renderPage();}
function renderPage(){document.getElementById('quiz').innerHTML='<p>'+ORDERED[CUR]?.text+'</p>';
 document.getElementById('pageInfo').textContent=`${CUR+1} / ${PAGES}`;
 document.getElementById('prevBtn').disabled=(CUR===0);
 document.getElementById('nextBtn').classList.toggle('hidden',CUR===PAGES-1);
 document.getElementById('finishBtn').classList.toggle('hidden',CUR!==PAGES-1);}
function score(){return{M:{lp_all:70.8,np_all:16,rp_all:13.3,lp_lr:84.2,rp_lr:15.8},E:{lp_all:52,np_all:13.9,rp_all:34.1,lp_lr:60.4,rp_lr:39.6},L:{lp_all:19,np_all:4.9,rp_all:76.1,lp_lr:20,rp_lr:80},P:{lp_all:33,np_all:8.5,rp_all:58.5,lp_lr:36.1,rp_lr:63.9}};}
function decideSide(d){const diff=Math.abs(d.lp_lr-d.rp_lr);if(d.np_all>=30&&diff<10) return '중도';if(d.np_all<30&&diff<5) return '중도';return d.lp_lr>=d.rp_lr?'좌':'우';}
function buildTitle(s){const m=decideSide(s.M),e=decideSide(s.E),l=decideSide(s.L),p=decideSide(s.P);
 const mprefix=m==='좌'?'친마법':m==='우'?'반마법':'마법중립';
 const key=`${e}-${l}-${p}`;const label=COMBOS[key]||"복합주의자";
 return `${mprefix} ${label}`;}
function buildGradient(lp,np,rp){return `linear-gradient(90deg, var(--good) 0%, var(--good2) ${lp}%, #fff ${(lp+np/2)}%, var(--warn) ${(lp+np)}%, var(--warn2) 100%)`;}
function renderResults(){document.getElementById('stageChip').textContent='결과';
 document.getElementById('quizWrap').classList.add('hidden');
 const s=score();const resultsEl=document.getElementById('results');resultsEl.innerHTML='';
 const title=buildTitle(s);
 const titleCard=document.createElement('div');titleCard.className='card';titleCard.innerHTML=`<h2>${title}</h2>`;resultsEl.appendChild(titleCard);
 ['M','E','L','P'].forEach(axis=>{const d=s[axis];const bar=document.createElement('div');bar.className='bar';
 const grad=buildGradient(d.lp_all,d.np_all,d.rp_all);
 bar.innerHTML=`<h3>${axis}</h3><div class="barrow" style="background:${grad}"><div class="baroverlay"><div class="cell" style="width:${d.lp_all}%">${d.lp_all}%</div><div class="cell" style="width:${d.np_all}%">${d.np_all}%</div><div class="cell" style="width:${d.rp_all}%">${d.rp_all}%</div></div></div>`;
 resultsEl.appendChild(bar);});
 resultsEl.classList.remove('hidden');document.getElementById('resultsActions').classList.remove('hidden');}

// 이벤트
startBtn.onclick=initQuiz;prevBtn.onclick=()=>{CUR=Math.max(0,CUR-1);renderPage()};nextBtn.onclick=()=>{CUR=Math.min(PAGES-1,CUR+1);renderPage()};finishBtn.onclick=renderResults;restartBtn.onclick=()=>{document.getElementById('results').innerHTML='';document.getElementById('results').classList.add('hidden');document.getElementById('resultsActions').classList.add('hidden');document.getElementById('quizWrap').classList.add('hidden');document.getElementById('start').classList.remove('hidden');document.getElementById('stageChip').textContent='시작 전';};
</script>
</body>
</html>
